<html>
	<head>
		<meta charset="utf-8">
<style>
.button2{
	background-color:rgba(255,60,0,1.0)
	border:none;
	color:grey;
	padding:15px 32px;
	text-align:center;
	text-decoration:none;
	display:inline-block;
	font-size:16px;
	margin:4px 2px;
	cursor:pointer;
}
input,button{background-color:rgba(255,60,0,1.0);
	border:none;
	color:black;
}
textarea{background-color:black;
	border-color:rgba(255,60,0,1.0);
	color:grey;
	scrollbar-face-color:black;
	scrollbar-track-color:rgba(255,60,0,1.0);
	scrollbar-arrow-color:black;
	scrollbar-highlight-color:orange;
	scrollbar-shadow-color:orange;
	scrollbar-3dlight-color:orange;
	scrollbar-darkshadow-color:orange;
}
</style>
		<script type="text/javascript">
var strLoadDictionaryFirst="Load dictionary first";
var strLoadKeyboardDictionaryFirst="Load keyboard dictionary first";
var varDictionary=null,varDictionaryKeys=null,varDictionaryValues=null;
var varDictionaryEntries=null;
var textArea;
var txtInputs=[];
var intPreviousTxtInput=-1;
var txtInput=function(textArea,divInches,chkInches){
	this.textArea=textArea;
	this.textArea.super=this;
	this.blnOnInputDone=false;
	this.divInches=divInches;
	this.strReplaceEntry=null;
	this.intReplaceEntryIndex=null;
	this.intReplaceEntrySubindex=null;
	this.chkInches=chkInches;
	this.strTextBefore="";
	this.strTextOnCursor="";
	this.strTextAfter="";
	this.blnWordChoiceMode=false;
	this.textArea.onkeydown=this.txtInputKeyDown;
	this.textArea.oninput=this.txtInputOnInput;
	this.chkInches.onchange=this.chkInchesChanged;
	this.chkInches.super=this;
	txtInputs.push(this);
	this.intMyId=txtInputs.length-1;
	var intMyId=this.intMyId;
	this.textArea.onfocus=function(){
		intPreviousTxtInput=intMyId;
	};
	this.textArea.onclick=function(){
		if(true==this.super.blnWordChoiceMode){
			this.super.escapePressed(null);
		}
	};
};
var varSlownik=null,varSlownikKeys=null,varSlownikValues=null;
var varSlownikEntries=null;
var lstLastSearch=[];
var lstStringsToConvert=["aāáǎà","eēéěè","iíīǐì","oōóǒò","uūúǔù"];
function btnOpenDictionaryPressed(){
	openFile(dispFile);
}
function btnOpenBothDictionaryPressed(){
	openFile(dispBothDictionaries);
}
function btnOpenSlownikPressed(){
	openFile(dispSlownik);
}
function btnFindSymbolsPressed(){
	if(null==varSlownik){
		alert(strLoadDictionaryFirst);
		return;
	};
	var txtSymbols=document.getElementById("txtSymbols");
	var strPrevSymbolsToFind=txtSymbols.value;
	var strSymbolsToFind=prompt("Enter symbols to find:",strPrevSymbolsToFind);
	if(undefined==strSymbolsToFind||strSymbolsToFind.length<=0)return;
	var lstEntry,jj=-1;
	var theKey=null;
	var intKey=-1;
	varSlownikKeys=Object.keys(varSlownik);
	var intSymbols=-1;
	var strPinyin,strMeanings0,strMeanings1,strMeaning2;
	for(var strKey in varSlownik){
		lstEntry=varSlownik[strKey];
		intKey=varSlownikKeys.indexOf(strKey);
		strPinyin=lstEntry[0];
		strMeanings0=lstEntry[1][0];
		strMeanings1=lstEntry[2][0];
		strMeanings2=lstEntry[3][0];
		if(strKey==lstLastSearch[0]&&strPinyin==lstLastSearch[1]&&strMeanings0==lstLastSearch[2]&&strMeanings1==lstLastSearch[3]&&strMeanings2==lstLastSearch[4])continue;
		intSymbols=strKey.indexOf(strSymbolsToFind);
		if(-1!=intSymbols){
			theKey=strKey;break;

		}
	}
	if(null==theKey)return;
	else{
		lstEntry=varSlownik[strKey];
		var txtSymbols=document.getElementById("txtSymbols");
		var txtMeanings0=document.getElementById("txtMeanings0");
		var txtMeanings1=document.getElementById("txtMeanings1");
		var txtMeanings2=document.getElementById("txtMeanings2");
		txtSymbols.value=strKey;
		txtPinyin.value=lstEntry[0];
		strMeanings0=lstEntry[1][0];
		if(undefined!=strMeanings0)
			txtMeanings0.value=strMeanings0;
		strMeanings1=lstEntry[2][0];
		if(undefined!=strMeanings1)
			txtMeanings1.value=strMeanings1;
		strMeanings2=lstEntry[3][0];
		if(undefined!=strMeanings2)
			txtMeanings2.value=strMeanings2;
		lstLastSearch=[txtSymbols.value,txtPinyin.value,txtMeanings0.value,txtMeanings1.value,txtMeanings2.value,strSymbolsToFind,intKey];

	}
}
function btnFindSymbolsNextPressed(){
	if(null==varSlownik){
		alert(strLoadDictionaryFirst);
		return;
	};
	var txtSymbols=document.getElementById("txtSymbols");
	var strSymbolsToFind=lstLastSearch[5];
	var intPrevKey=lstLastSearch[6];
	if(undefined==strSymbolsToFind||strSymbolsToFind.length<=0)return;
	var lstEntry,jj=-1;
	var theKey=null;
	var intKey=-1;
	varSlownikKeys=Object.keys(varSlownik);
	var intSymbols=-1;
	var strPinyin,strMeanings0,strMeanings1,strMeaning2;
	for(var strKey in varSlownik){
		lstEntry=varSlownik[strKey];
		intKey=varSlownikKeys.indexOf(strKey);
		strPinyin=lstEntry[0];
		strMeanings0=lstEntry[1][0];
		strMeanings1=lstEntry[2][0];
		strMeanings2=lstEntry[3][0];
		if(strKey==lstLastSearch[0]&&strPinyin==lstLastSearch[1]&&strMeanings0==lstLastSearch[2]&&strMeanings1==lstLastSearch[3]&&strMeanings2==lstLastSearch[4])continue;
		if(intKey<=intPrevKey)continue;
		intSymbols=strKey.indexOf(strSymbolsToFind);
		if(-1!=intSymbols){
			theKey=strKey;break;

		}
	}
	if(null==theKey)return;
	else{
		lstEntry=varSlownik[strKey];
		var txtSymbols=document.getElementById("txtSymbols");
		var txtMeanings0=document.getElementById("txtMeanings0");
		var txtMeanings1=document.getElementById("txtMeanings1");
		var txtMeanings2=document.getElementById("txtMeanings2");
		txtSymbols.value=strKey;
		txtPinyin.value=lstEntry[0];
		strMeanings0=lstEntry[1][0];
		if(undefined!=strMeanings0)
			txtMeanings0.value=strMeanings0;
		strMeanings1=lstEntry[2][0];
		if(undefined!=strMeanings1)
			txtMeanings1.value=strMeanings1;
		strMeanings2=lstEntry[3][0];
		if(undefined!=strMeanings2)
			txtMeanings2.value=strMeanings2;
		lstLastSearch=[txtSymbols.value,txtPinyin.value,txtMeanings0.value,txtMeanings1.value,txtMeanings2.value,strSymbolsToFind,intKey];

	}

}
function btnFindWordPressed(blnPrompt){
	if(null==varSlownik){
		alert(strLoadDictionaryFirst);
		return;
	}
	var btnUpdate=document.getElementById("btnUpdate");
	btnUpdate.innerText="Update";
	var btnDelete=document.getElementById("btnDelete");
	btnDelete.innerText="Delete";
	var txtSymbols=document.getElementById("txtSymbols");
	var strPrevKey=txtSymbols.value;

	var intKey=-1;
	varSlownikKeys=Object.keys(varSlownik);
	var strKey;
	if(false==blnPrompt)
		strKey=strPrevKey;
	else strKey=prompt("Enter word symbols string to find:",strPrevKey);
	if(undefined==strKey||strKey.length<=0)return;
	if(null==strKey||0==strKey.length)return;
	var lstEntry=varSlownik[strKey];
	intKey=varSlownikKeys.indexOf(strKey);
	var txtPinyin=document.getElementById("txtPinyin");
	var txtMeanings0=document.getElementById("txtMeanings0");
	var txtMeanings1=document.getElementById("txtMeanings1");
	var txtMeanings2=document.getElementById("txtMeanings2");
	var strMeanings0,strMeanings1,strMeanigs2;
	if(undefined!=lstEntry){
		if(txtSymbols.value==lstLastSearch[0]&&txtPinyin.value==lstLastSearch[1]&&txtMeanings0.value==lstLastSearch[2]&&txtMeanings1.value==lstLastSearch[3]&&txtMeanings2==lstLastSearch[4])return;
		txtSymbols.value=strKey;
		txtPinyin.value=lstEntry[0];
		strMeanings0=lstEntry[1][0];
		if(undefined!=strMeanings0)
			txtMeanings0.value=strMeanings0;
		else txtMeanings0.value="";
		strMeanings1=lstEntry[2][0];
		if(undefined!=strMeanings1)
			txtMeanings1.value=strMeanings1;
		else txtMeanings1.value="";
		strMeanings2=lstEntry[3][0];
		if(undefined!=strMeanings2)
			txtMeanings2.value=strMeanings2;
		else txtMeanings2.value="";
		lstLastSearch=[txtSymbols.value,txtPinyin.value,txtMeanings0.value,txtMeanings1.value,txtMeanings2.value,strKey,intKey];
	}else{
		txtPinyin.value="";
		txtMeanings0.value="";
		txtMeanings1.value="";
		txtMeanings2.value="";
	}
}
function btnFindPinyinPressed(){
	if(null==varSlownik){
		alert(strLoadDictionaryFirst);
		return;
	};
	var txtPinyin=document.getElementById("txtPinyin");
	var strPrevPinyinToFind=txtPinyin.value;
	var strPinyinToFind=prompt("Enter pinyin to find:",strPrevPinyinToFind);
	if(undefined==strPinyinToFind||strPinyinToFind.length<=0)return;
	var lstEntry,jj=-1;
	var theKey=null;
	var intKey=-1;
	varSlownikKeys=Object.keys(varSlownik);
	var strPinyin,strMeanings0,strMeanings1,strMeaning2;
	var strSimplePinyin0,strSimplePinyin1;
	for(var strKey in varSlownik){
		lstEntry=varSlownik[strKey];
		intKey=varSlownikKeys.indexOf(strKey);
		strPinyin=lstEntry[0];
		strMeanings0=lstEntry[1][0];
		strMeanings1=lstEntry[2][0];
		strMeanings2=lstEntry[3][0];
		if(strKey==lstLastSearch[0]&&strPinyin==lstLastSearch[1]&&strMeanings0==lstLastSearch[2]&&strMeanings1==lstLastSearch[3]&&strMeanings2==lstLastSearch[4])continue;
		strSimplePinyin0=simplifyPinyin(lstEntry[0]);
		strSimplePinyin1=simplifyPinyin(strPinyinToFind);
		if(strSimplePinyin0==strSimplePinyin1){
			theKey=strKey;break;
		}
	}
	if(null==theKey)return;
	else{
		lstEntry=varSlownik[strKey];
		var txtSymbols=document.getElementById("txtSymbols");
		var txtMeanings0=document.getElementById("txtMeanings0");
		var txtMeanings1=document.getElementById("txtMeanings1");
		var txtMeanings2=document.getElementById("txtMeanings2");
		txtSymbols.value=strKey;
		txtPinyin.value=lstEntry[0];
		strMeanings0=lstEntry[1][0];
		if(undefined!=strMeanings0)
			txtMeanings0.value=strMeanings0;
		strMeanings1=lstEntry[2][0];
		if(undefined!=strMeanings1)
			txtMeanings1.value=strMeanings1;
		strMeanings2=lstEntry[3][0];
		if(undefined!=strMeanings2)
			txtMeanings2.value=strMeanings2;
		lstLastSearch=[txtSymbols.value,txtPinyin.value,txtMeanings0.value,txtMeanings1.value,txtMeanings2.value,strPinyinToFind,intKey];

	}
}
function btnFindPinyinNextPressed(){
	if(null==varSlownik){
		alert(strLoadDictionaryFirst);
		return;
	};
	var txtPinyin=document.getElementById("txtPinyin");
	var strPinyinToFind=lstLastSearch[5];
	if(undefined==strPinyinToFind||strPinyinToFind.length<=0)return;
	var intPrevKey=lstLastSearch[6];
	var lstEntry,jj=-1;;
	var theKey=null;
	var intKey=-1;
	varSlownikKeys=Object.keys(varSlownik);
	var strPinyin,strMeanings0,strMeanings1,strMeaning2;
	var strSimplePinyin0,strSimplePinyin1;
	for(var strKey in varSlownik){
		lstEntry=varSlownik[strKey];
		intKey=varSlownikKeys.indexOf(strKey);
		strPinyin=lstEntry[0];
		strMeanings0=lstEntry[1][0];
		strMeanings1=lstEntry[2][0];
		strMeanings2=lstEntry[3][0];
		if(strKey==lstLastSearch[0]&&strPinyin==lstLastSearch[1]&&strMeanings0==lstLastSearch[2]&&strMeanings1==lstLastSearch[3]&&strMeanings2==lstLastSearch[4])continue;
		if(intKey<=intPrevKey)continue;
		strSimplePinyin0=simplifyPinyin(lstEntry[0]);
		strSimplePinyin1=simplifyPinyin(strPinyinToFind);
		if(-1!=strSimplePinyin0.indexOf(strSimplePinyin1)){
			theKey=strKey;break;
		}
	}
	if(null==theKey)return;
	else{
		lstEntry=varSlownik[strKey];
		var txtSymbols=document.getElementById("txtSymbols");
		var txtMeanings0=document.getElementById("txtMeanings0");
		var txtMeanings1=document.getElementById("txtMeanings1");
		var txtMeanings2=document.getElementById("txtMeanings2");
		txtSymbols.value=strKey;
		txtPinyin.value=lstEntry[0];
		strMeanings0=lstEntry[1][0];
		if(undefined!=strMeanings0)
			txtMeanings0.value=strMeanings0;
		strMeanings1=lstEntry[2][0];
		if(undefined!=strMeanings1)
			txtMeanings1.value=strMeanings1;
		strMeanings2=lstEntry[3][0];
		if(undefined!=strMeanings2)
			txtMeanings2.value=strMeanings2;
		lstLastSearch=[txtSymbols.value,txtPinyin.value,txtMeanings0.value,txtMeanings1.value,txtMeanings2.value,strPinyinToFind,intKey];
	}
}
function btnFindMeaningsPressed(){
	if(null==varSlownik){
		alert(strLoadDictionaryFirst);
		return;
	};
	var txtMeanings0=document.getElementById("txtMeanings0");
	var txtMeanings1=document.getElementById("txtMeanings1");
	var txtMeanings2=document.getElementById("txtMeanings2");
	var strPrevMeaningsSearched=null;
	var intKey=-1;
	varSlownikKeys=Object.keys(varSlownik);
	if(txtMeanings0.value.length>0)strPrevMeaningsSearched=txtMeanings0.value;
	if(null==strPrevMeaningsSearched&&txtMeanings1.value.length>0)strPrevMeaningsSearched=txtMeanings1.value;
	if(null==strPrevMeaningsSearched&&txtMeanings2.value.length>0)strPrevMeaningsSearched=txtMeanings2.value;
	if(null==strPrevMeaningsSearched)strPrevMeaningsSearched="";
	var strMeaningsToFind=prompt("Enter meanings string to find:",strPrevMeaningsSearched);
	if(undefined==strMeaningsToFind||strMeaningsToFind.length<=0)return;
	var strMeanings0,strMeanings1,strMeanings2,strPinyin;
	var intMeaning0=-1,intMeaning1=-1,intMeaning2=-1;
	var lstEntry,jj=-1;
	var theKey=null;
	for(var strKey in varSlownik){
		intKey=varSlownikKeys.indexOf(strKey);
		intMeaning0=-1;intMeaning1=-1;intMeaning2=-1;
		lstEntry=varSlownik[strKey];
		strMeanings0=lstEntry[1][0];
		strMeanings1=lstEntry[2][0];
		strMeanings2=lstEntry[3][0];
		strPinyin=lstEntry[0];
		if(strKey==lstLastSearch[0]&&strPinyin==lstLastSearch[1]&&strMeanings0==lstLastSearch[2]&&strMeanings1==lstLastSearch[3]&&strMeanings2==lstLastSearch[4])continue;
		if(undefined!=strMeanings0)intMeaning0=strMeanings0.toLowerCase().indexOf(strMeaningsToFind.toLowerCase());
		if(undefined!=strMeanings1)intMeaning1=strMeanings1.toLowerCase().indexOf(strMeaningsToFind.toLowerCase());
		if(undefined!=strMeanings2)intMeaning2=strMeanings2.toLowerCase().indexOf(strMeaningsToFind.toLowerCase());
		if(-1!=intMeaning0||-1!=intMeaning1||-1!=intMeaning2){
			theKey=strKey;break;
		}
	}
	if(null==theKey)return;
	else{
		var txtPinyin=document.getElementById("txtPinyin");
		lstEntry=varSlownik[strKey];
		var txtSymbols=document.getElementById("txtSymbols");
		txtSymbols.value=strKey;
		txtPinyin.value=lstEntry[0];
		txtMeanings0.value=lstEntry[1][0];
		txtMeanings1.value=lstEntry[2][0];
		txtMeanings2.value=lstEntry[3][0];
		lstLastSearch=[txtSymbols.value,txtPinyin.value,txtMeanings0.value,txtMeanings1.value,txtMeanings2.value,strMeaningsToFind,intKey];
	}
}
function btnFindMeaningsNextPressed(){
	if(null==varSlownik){
		alert(strLoadDictionaryFirst);
		return;
	};
	var strPrevMeaningsSearched=lstLastSearch[5];
	if(undefined==strPrevMeaningsSearched||strPrevMeaningsSearched.length<=0)return;
	var intPrevKey=lstLastSearch[6];
	if(undefined!=strPrevMeaningsSearched){
		var strMeanings0,strMeanings1,strMeanings2,strPinyin;
		var intMeaning0=-1,intMeaning1=-1,intMeaning2=-1;
		var lstEntry,jj=-1;;
		var theKey=null;
		varSlownikKeys=Object.keys(varSlownik);
		var intKey=-1;
		for(var strKey in varSlownik){
			intMeaning0=-1;intMeaning1=-1;intMeaning2=-1;
			lstEntry=varSlownik[strKey];
			strMeanings0=lstEntry[1][0];
			strMeanings1=lstEntry[2][0];
			strMeanings2=lstEntry[3][0];
			strPinyin=lstEntry[0];
			intKey=varSlownikKeys.indexOf(strKey);
			if(intKey<=intPrevKey)continue;
			if(undefined!=strMeanings0)intMeaning0=strMeanings0.toLowerCase().indexOf(strPrevMeaningsSearched.toLowerCase());
			if(undefined!=strMeanings1)intMeaning1=strMeanings1.toLowerCase().indexOf(strPrevMeaningsSearched.toLowerCase());
			if(undefined!=strMeanings2)intMeaning2=strMeanings2.toLowerCase().indexOf(strPrevMeaningsSearched.toLowerCase());
			if(-1!=intMeaning0||-1!=intMeaning1||-1!=intMeaning2){
				theKey=strKey;break;
			}
		}
		if(null==theKey)return;
		else{
			var txtPinyin=document.getElementById("txtPinyin");
			lstEntry=varSlownik[strKey];
			var txtSymbols=document.getElementById("txtSymbols");
			txtSymbols.value=strKey;
			txtPinyin.value=lstEntry[0];
			txtMeanings0.value=lstEntry[1][0];
			txtMeanings1.value=lstEntry[2][0];
			txtMeanings2.value=lstEntry[3][0];
			lstLastSearch=[txtSymbols.value,txtPinyin.value,txtMeanings0.value,txtMeanings1.value,txtMeanings2.value,strPrevMeaningsSearched,intKey];
		}
	}
}
function btnSearchFrom0pressed(){
	lstLastSearch[6]=0;
}
function btnDeletePressed(){
	var txtSymbols=document.getElementById("txtSymbols");
	var strKey=txtSymbols.value;
	if(0==strKey.length)return;
    	delete varSlownik[strKey];
	var btnDelete=document.getElementById("btnDelete");
	btnDelete.innerText="Deleted";
	var txtSymbols=document.getElementById("txtSymbols");
	var txtPinyin=document.getElementById("txtPinyin");
	var txtMeanings0=document.getElementById("txtMeanings0");
	var txtMeanings1=document.getElementById("txtMeanings1");
	var txtMeanings2=document.getElementById("txtMeanings2");
}
function btnUpdatePressed(){
	if(null==varSlownik){
		alert(strLoadDictionaryFirst);
		return;
	}
	var txtSymbols=document.getElementById("txtSymbols");
	var strKey=txtSymbols.value;
	if(0==strKey.length)return;
	var lstEntry=varSlownik[strKey];
	var txtPinyin=document.getElementById("txtPinyin");
    	if(txtPinyin.value.length<=0){
    		alert("Pinyin empty");
    		return;
    	}
	var txtMeanings0=document.getElementById("txtMeanings0");
	var txtMeanings1=document.getElementById("txtMeanings1");
	var txtMeanings2=document.getElementById("txtMeanings2");
	var strPinyin,strMeanings0,strMeanings1,strMeanigs2;
	if(undefined!=lstEntry){
		strPinyin=txtPinyin.value;
		strMeanings0=txtMeanings0.value;
		strMeanings1=txtMeanings1.value;
		strMeanings2=txtMeanings2.value;
		varSlownik[strKey][0]=strPinyin;
		varSlownik[strKey][1][0]=strMeanings0;
		varSlownik[strKey][2][0]=strMeanings1;
		varSlownik[strKey][3][0]=strMeanings2;
	}else{
		varSlownik[strKey]=[];
		strPinyin=txtPinyin.value;
		strMeanings0=txtMeanings0.value;
		strMeanings1=txtMeanings1.value;
		strMeanings2=txtMeanings2.value;
		varSlownik[strKey][0]=strPinyin;
		varSlownik[strKey][1]=[];
		varSlownik[strKey][1].push(strMeanings0);
		varSlownik[strKey][2]=[];
		varSlownik[strKey][2].push(strMeanings1);
		varSlownik[strKey][3]=[];
		varSlownik[strKey][3].push(strMeanings2);
	}
	var btnUpdate=document.getElementById("btnUpdate");
	btnUpdate.innerText="Updated";
}

function fullScreenSize(textArea){
	var lineWidth=textArea.scrollWidth/textArea.cols;
	var lineHeight=textArea.scrollHeight/textArea.rows;
	textArea.cols=window.innerWidth/lineWidth;
	textArea.rows=(window.innerHeight-100)/lineHeight;
}
function btnResize1pressed(){
	var textArea=document.getElementById("txtInput");
	var strNewSize=prompt("Enter new dimensions in format [width,height]. String empty or with errors will set the fullscreen size.","["+textArea.cols+","+textArea.rows+"]");
	if(null==strNewSize)return;
	if(0==strNewSize.length){
		fullScreenSize(textArea);
		return;
	}
	var strError="New dimension is not in format [width,height], where width and height are numbers.";
	if("["!=strNewSize[0]||"]"!=strNewSize.substring(strNewSize.length-1,strNewSize.length)){
		alert(strError);
		fullScreenSize(textArea);
		return;
	}
	var lstDimensions=strNewSize.substring(1,strNewSize.length-1).split(",");
	if(2!=lstDimensions.length){
		alert(strError);
		fullScreenSize(textArea);
		return;
	}
	var intWidth=parseInt(lstDimensions[0]);
	var intHeight=parseInt(lstDimensions[1]);
	if(true==Number.isNaN(intWidth)){
		alert(strError);
		fullScreenSize(textArea);
		return;
	}
	if(true==Number.isNaN(intHeight)){
		alert(strError);
		fullScreenSize(textArea);
		return;
	}
	textArea.cols=intWidth;
	textArea.rows=intHeight;
}
function btnResize2pressed(){
	var textArea=document.getElementById("txtSlownik");
	var strNewSize=prompt("Enter new dimensions in format [width,height]. String empty or with errors will set the fullscreen size.","["+textArea.cols+","+textArea.rows+"]");
	if(null==strNewSize)return;
	if(0==strNewSize.length){
		fullScreenSize(textArea);
		return;
	}
	var strError="New dimension is not in format [width,height], where width and height are numbers.";
	if("["!=strNewSize[0]||"]"!=strNewSize.substring(strNewSize.length-1,strNewSize.length)){
		alert(strError);
		fullScreenSize(textArea);
		return;
	}
	var lstDimensions=strNewSize.substring(1,strNewSize.length-1).split(",");
	if(2!=lstDimensions.length){
		alert(strError);
		fullScreenSize(textArea);
		return;
	}
	var intWidth=parseInt(lstDimensions[0]);
	var intHeight=parseInt(lstDimensions[1]);
	if(true==Number.isNaN(intWidth)){
		alert(strError);
		fullScreenSize(textArea);
		return;
	}
	if(true==Number.isNaN(intHeight)){
		alert(strError);
		fullScreenSize(textArea);
		return;
	}
	textArea.cols=intWidth;
	textArea.rows=intHeight;
}
function btnArtificialEscapeClicked(){
	var txtActualInput=txtInputs[intPreviousTxtInput];
	if(undefined==txtActualInput){
		return;
	}
	var newEvent=txtActualInput.emptyKeyEvent();
	newEvent.key="Escape";newEvent.code="Escape";
	txtActualInput.txtInputKeyDown(newEvent);
	txtActualInput.blnOninputDone=false;
}
function btnArtificialBackspaceClicked(){
	var txtActualInput=txtInputs[intPreviousTxtInput];
	if(undefined==txtActualInput){
		return;
	}
	txtActualInput.artificialBackspacePressed();
}
function txtSymbolsChanged(){
	btnFindWordPressed(false);
}
function txtMeanings0Changed(){
	btnUpdatePressed();
}
function txtMeanings1Changed(){
	btnUpdatePressed();
}
function txtMeanings2Changed(){
	btnUpdatePressed();
}
function getString(strSubstring){
	var int34_0,int34_1,int39_0,int39_1;
	int34_0=strSubstring.indexOf(String.fromCharCode(34));
	int34_1=strSubstring.substring(int34_0+1).indexOf(String.fromCharCode(34));
	int39_0=strSubstring.indexOf(String.fromCharCode(39));
	int39_1=strSubstring.substring(int39_0+1).indexOf(String.fromCharCode(39));
	if(!((-1!=int34_0&&-1!=int34_1)||(-1!=int39_0&&-1!=int39_1))){
		console.log(strSubstring+ "not a substring");
		return null;
	}
	if(-1!=int34_0){
		int34_1+=int34_0+1;
		return strSubstring.substring(int34_0+1,int34_1);
	}else{
		int39_1+=int39_0+1;
		return strSubstring.substring(int39_0+1,int39_1);
	}
}
function getLastIndexOf(strSubstring,strSearch){
	var intIndex=strSubstring.indexOf(strSearch);
	if(-1==intIndex)return -1;
	intPrevIndex=intIndex;
	while(-1!=intIndex){
		intIndex=strSubstring.substring(intPrevIndex+1).indexOf(strSearch);
		if(-1!=intIndex)intPrevIndex+=(intIndex+1);
	}
	return intPrevIndex;
}
function getFirstList(strSubstring){
	var lstReturn=[];
	var int91,int93;
	int91=strSubstring.indexOf("[");
	int93=strSubstring.indexOf("]");
	if(-1==int91||-1==int93||int91>=int93){
		return [null,null];
	}
	var strList=strSubstring.substring(int91+1,int93);
	var lstList=strList.split(",");
	for(var ii=0;ii<lstList.length;ii++){
		lstReturn.push(getString(lstList[ii]));
	}
	return [lstReturn,int93+1];
}
function getLists(strSubstring){
	var lstReturn=[];
	var int91,int93;
	int91=strSubstring.indexOf("[");
	int93=getLastIndexOf(strSubstring,"]");
	if(-1==int91||-1==int93||int91==int93){
		console.log(strSubstring+ " not a list of lists");
		return;
	}
	var strList=strSubstring.substring(int91+1,int93);
	var lstSublist,intNewSearchPosition;
	[lstSublist,intNewSearchPosition]=getFirstList(strList);
	while(null!=lstSublist){
		lstReturn.push(lstSublist);
		strList=strList.substring(intNewSearchPosition);
		[lstSublist,intNewSearchPosition]=getFirstList(strList);
	}
	return lstReturn;
}
function parseContents(contents){
	varDictionary={};
	var int123,int125,int58;
	int123=contents.indexOf("{");
	int125=contents.indexOf("}");
	var strContents=contents.substring(int123+1,int125-1);
	var lstLines=strContents.split(String.fromCharCode(10));
	var strLine,strKey,lstValues;
	for(var ii=0;ii<lstLines.length;ii++){
		strLine=lstLines[ii];
		int58=strLine.indexOf(":");
		if(-1==int58)continue;
		strKey=getString(strLine.substring(0,int58));
		if(0==strKey.length)continue;
		if(","==strKey)continue;
		lstValues=getLists(strLine.substring(int58+1));
		if(undefined==varDictionary[strKey]){
			varDictionary[strKey]=[];
			for(var jj=0;jj<lstValues.length;jj++)
				varDictionary[strKey].push(lstValues[jj]);
		}else for(var jj=0;jj<lstValues.length;jj++)
				varDictionary[strKey].push(lstValues[jj]);

	}
	return varDictionary;
}
function dispFile(contents) {
	/*varDictionary=JSON.parse(contents);*/
	varDictionary=parseContents(contents);
	varDictionaryKeys=Object.keys(varDictionary);
}
function linkSaveFile(contents,strFilename,strLinkname){
	var a=document.getElementById(strLinkname);
	if(strFilename)a.setAttribute("download",strFilename);
	var blob=new Blob([contents],{type:"text/plain"});
	var strUrl=URL.createObjectURL(blob);
	a.setAttribute("href",strUrl);
}
function listToString(lstList){
	var strList="[";
	for(var ii=0;ii<lstList.length;ii++){
		if("string"!=typeof(lstList[ii])&&undefined!=lstList[ii]&&lstList[ii].length>=0){
			strList+=listToString(lstList[ii]);
		}else{
			strList+=(String.fromCharCode(34)+lstList[ii]+String.fromCharCode(34));
		}
		if(ii<lstList.length-1)strList+=",";
	}
	strList+="]";
	return strList;
}
function dictionaryToString(dctSlownik){
	var strContent="{";
	var strKey;
	dctSlownikKeys=Object.keys(dctSlownik);
	for(var ii=0;ii<dctSlownikKeys.length;ii++){
		strKey=dctSlownikKeys[ii];
		strContent+=String.fromCharCode(10)+String.fromCharCode(34)+strKey+String.fromCharCode(34)+":"+listToString(dctSlownik[strKey]);
		if(ii<dctSlownikKeys.length-1)
			strContent+=",";
	}
	strContent+=String.fromCharCode(10)+"}";
	return strContent;
}
function saveSlownik(){
	return dictionaryToString(varSlownik);
}
function simplifyPinyin(strPinyin){
	var strSimplifiedPinyin="";
	var blnLetterSimplified=false;
	var strLowercasePinyin=strPinyin.toLowerCase();

	for(var ii=0;ii<strLowercasePinyin.length;ii++){
		blnLetterSimplified=false;
		for(var jj=0;jj<lstStringsToConvert.length;jj++){
			for(var kk=1;kk<lstStringsToConvert.length;kk++){
				if(lstStringsToConvert[jj][kk]==strLowercasePinyin[ii]){
					strSimplifiedPinyin+=lstStringsToConvert[jj][0];
					blnLetterSimplified=true;
					break;
				}
			}
			if(true==blnLetterSimplified)break;
		}
		if(false==blnLetterSimplified)strSimplifiedPinyin+=strLowercasePinyin[ii];
	}
	return strSimplifiedPinyin;
}
function copyString(strSrc){
	return strSrc.split("").join("");
};
function copyList(lstSrc){
	if("string"==typeof(lstSrc))return copyString(lstSrc);
	if(undefined!=lstSrc.length){
		var lstDst=[];
		for(var ii=0;ii<lstSrc.length;ii++){
			lstDst.push(copyList(lstSrc[ii]));
		}
		return lstDst;
	}else{
		return lstSrc;
	}
}
function copyDictionary(dctSrc){
	var dctDst={};
	for(var strKey in dctSrc){
		dctDst[strKey]=copyList(dctSrc[strKey]);
	}
	return dctDst;
}
function getPinyinChunks(strPinyin){
	var strLetter=null;
	var strPinyinChunk="";
	var lstPinyinChunks=null;
	for(var jj=0;jj<strPinyin.length;jj++){
		strLetter=strPinyin[jj];	
		if(strLetter==strLetter.toUpperCase()){
			if(null==lstPinyinChunks)lstPinyinChunks=[];
			else lstPinyinChunks.push(strPinyinChunk);
			strPinyinChunk="";
		}
		strPinyinChunk+=strLetter;
	}
	lstPinyinChunks.push(strPinyinChunk);
	return lstPinyinChunks;
}
function strKeyOnList(strKey,lstEntry){
	for(var ii=0;ii<lstEntry.length;ii++){
		if(strKey==lstEntry[ii][0])
			return true;
	}
	return false;
}
function saveToKeyboardDictionary(){
	var dctKeyboard=copyDictionary(varDictionary);
	var strPinyin,strSimplifiedPinyin,lstEntry;
	var strPinyinChunk="";
	var strSimplifiedPinyinChunk="";
	var lstPinyinChunks=null;
	var strUnknownPinyin=null;
	var blnAllComponentsAlreadyAdded=false;
	var chkIgnoreUnknownPinyins=document.getElementById("chkIgnoreUnknownPinyins");
	for(var strKey in varSlownik){
		lstEntry=varSlownik[strKey];
		strPinyin=lstEntry[0];
		strSimplifiedPinyin=simplifyPinyin(strPinyin);
		if(undefined==dctKeyboard[strSimplifiedPinyin]){
			dctKeyboard[strSimplifiedPinyin]=[];
		}
		/*assumption:keys are unique*/
		if(false==strKeyOnList(strKey,dctKeyboard[strSimplifiedPinyin])){
			dctKeyboard[strSimplifiedPinyin].push([strKey,strPinyin]);
		}
		/*and now every new symbol and pinyin component*/
		if(strKey.length>1){
			lstPinyinChunks=getPinyinChunks(strPinyin);
			if(lstPinyinChunks.length!=strKey.length){
				if(true==chkIgnoreUnknownPinyins.checked)continue;
				strUnknownPinyin=prompt("Unknown pinyin for: "+strKey+" Write lstPinyinSymbols","["+lstPinyinChunks+"]");
				if(null==strUnknownPinyin)continue;
				lstPinyinChunks=strUnknownPinyin.substring(1,strUnknownPinyin.length-1).split(",");
				if(lstPinyinChunks.length!=strKey.length){
					alert("Incorrect pinyin "+[lstPinyinChunks.length,strKey.length]);
					return;
				}
			}	
			for(var ii=0;ii<strKey.length;ii++){
				strPinyinChunk=lstPinyinChunks[ii];
				strSimplifiedPinyinChunk=simplifyPinyin(strPinyinChunk);
				if(undefined==dctKeyboard[strSimplifiedPinyinChunk]){
					dctKeyboard[strSimplifiedPinyinChunk]=[];
				}
				if(false==strKeyOnList(strKey[ii],dctKeyboard[strSimplifiedPinyinChunk])){
					dctKeyboard[strSimplifiedPinyinChunk].push([strKey[ii],strPinyinChunk]);
				}
				
			}
		}
	}
	return dctKeyboard;
}
function btnSaveSlownikPressed(){
	var strContent=saveSlownik();
	linkSaveFile(strContent,"dictionary.txt","save");
}
function btnCorrectTonesPressed(){
	alert("Functionality not implemented yet.");
}
function removeDuplicates(dctDictionary){
	/*no need now, adding unique, but nonunique can be required*/
}
function symbolInEntry(lstEntry,strSymbol){
	for(var ii=0;ii<lstEntry.length;ii++){
		if(lstEntry[ii][0]==strSymbol)return true;
	}
	return false;
}
function lstEntryToLowercase(lstEntry){
	return [lstEntry[0],lstEntry[1].toLowerCase()];
};
function concatenateDictionaries(dctDictionary0,dctDictionary1){
	var dctDictionary2={};	
	var lstEntry;
	for(var strKey in dctDictionary0){
		if(undefined==dctDictionary2[strKey])dctDictionary2[strKey]=dctDictionary0[strKey];
		else{ 
			lstEntry=dctDictionary0[strKey];
			for(var ii=0;ii<lstEntry.length;ii++)
				if(false==symbolInEntry(dctDictionary2[strKey],lstEntry[ii][0])){
					dctDictionary2[strKey].push(lstEntry[ii]);
					/*dctDictionary2[strKey].push(lstEntryToLowercase(lstEntry[ii]));*/
				}
		}
	}
	for(var strKey in dctDictionary1){
		if(undefined==dctDictionary2[strKey])dctDictionary2[strKey]=dctDictionary1[strKey];
		else{ 
			lstEntry=dctDictionary1[strKey];
			for(var ii=0;ii<lstEntry.length;ii++)
				if(false==symbolInEntry(dctDictionary2[strKey],lstEntry[ii][0])){
					dctDictionary2[strKey].push(lstEntry[ii]);
					/*dctDictionary2[strKey].push(lstEntryToLowercase(lstEntry[ii]));*/
				}
		}
	}
	removeDuplicates(dctDictionary2);
	return dctDictionary2;
}
function btnAppendToKeyboardDictionaryPressed(){
	var dctDictionary=saveToKeyboardDictionary();
	var strContent=dictionaryToString(dctDictionary);
	linkSaveFile(strContent,"keyboardDictionary.txt","save");
}
function btnSaveBothDictionariesPressed(){
	var dctDictionary=saveToKeyboardDictionary();
	var strContent=dictionaryToString(dctDictionary);
	var strSlownikContent=saveSlownik();
     	strContent+=String.fromCharCode(10);
	strContent+=strSlownikContent;
	linkSaveFile(strContent,"bothDictionaries.txt","save");
}
function printSlownik(){
	var strContent=saveSlownik();
	var txtSlownik=document.getElementById("txtSlownik");
	txtSlownik.value=strContent;
}
function printKeyboardDictionary(){
	var txtSlownik=document.getElementById("txtSlownik");
	var dctDictionary=saveToKeyboardDictionary();
	var strContent=dictionaryToString(dctDictionary);
	txtSlownik.value=strContent;
}
function dispSlownik(contents) {
	varSlownik=JSON.parse(contents);
	varSlownikKeys=Object.keys(varSlownik);
	/*varDictionaryEntries=Object.entries(varSlownik);*/
}
function dispBothDictionaries(contents) {
	var lstContents=contents.split(String.fromCharCode(10));
	var slownikContents="",keyboardContents="";
	var blnSecondDictionary=false;
  	for(var ii=0;ii<lstContents.length;ii++){
     		if(false==blnSecondDictionary)keyboardContents+=(lstContents[ii]+String.fromCharCode(10));
     		else slownikContents+=(lstContents[ii]+String.fromCharCode(10));
     		if(-1!=lstContents[ii].indexOf("}"))blnSecondDictionary=true;
     	}
	varDictionary=parseContents(keyboardContents);
	varDictionaryKeys=Object.keys(varDictionary);

	varSlownik=JSON.parse(slownikContents);
	varSlownikKeys=Object.keys(varSlownik);
}
function clickElem(elem){
	var eventMouse=document.createEvent("MouseEvents");
	eventMouse.initMouseEvent("click",true,false,window,0,0,0,0,0,false,false,false,false,0,null);
	elem.dispatchEvent(eventMouse);

}
function openFile(func){
	var arrNames;
	readFile=function(e) {
		var file = e.target.files[0];
		if (!file) {
			return;
		}       
		var reader= new FileReader();

		reader.onload=function(e) {
			var contents=e.target.result;
			fileInput.func(contents);
			document.body.removeChild(fileInput);

		};
		reader.readAsText(file);

	};

	fileInput=document.createElement("input");
	fileInput.type='file';
	fileInput.style.display='none';
	fileInput.onchange=readFile;
	fileInput.func=func;
	document.body.appendChild(fileInput);
	clickElem(fileInput);
}

txtInput.prototype.clearDivInches=function(){
	this.strReplaceEntry=null;
	this.intReplaceEntryIndex=null;
	this.intReplaceEntrySubindex=null;
	this.divInches.innerHTML="<br/>";
};
function cellClicked(intMyId,intIndex,strCurrentWord){
	txtInputs[intMyId].cellClicked(intIndex,strCurrentWord);
};
txtInput.prototype.cellClicked=function(intIndex,strCurrentWord){
	this.renderDivInches(strCurrentWord,intIndex);
	this.textArea.focus();
	this.replaceText();
	var newSelection=this.strTextBefore.length+this.strTextOnCursor.length;
	this.renderTxtInput();
	this.blnWordChoiceMode=false;
	this.clearDivInches();
	this.resetStrTexts();
	this.textArea.selectionStart=newSelection;
	this.textArea.selectionEnd=newSelection;
};
txtInput.prototype.keyInKeys=function(tblKeys,strKey){
	for (var i=0;i<tblKeys.length;i++){
		if (strKey==tblKeys[i]) return i;
	}
	return -1;
};
txtInput.prototype.renderDivInches=function(strCurrentWord,intSubentry){
	var intIndex=this.keyInKeys(varDictionaryKeys,strCurrentWord);
	if (-1==intIndex){
		this.clearDivInches();
		return;
	}
	var strDivInchesHTML="<table><tr>";
	varInches=varDictionary[strCurrentWord];
	this.intReplaceEntryIndex=intIndex;
	if(undefined==intSubentry)
		this.intReplaceEntrySubindex=0;
	else this.intReplaceEntrySubindex=intSubentry;
	if(this.intReplaceEntrySubindex<0)this.intReplaceEntrySubindex=varInches.length-1;
	if(this.intReplaceEntrySubindex>=varInches.length)this.intReplaceEntrySubindex=0;
	this.strReplaceEntry=varInches[this.intReplaceEntrySubindex][0];
	for (var i=0; i<varInches.length;i++){
		if (i==this.intReplaceEntrySubindex)
			strDivInchesHTML+="<td bgcolor='ff6400' onclick='cellClicked("+this.intMyId+","+i+",\""+strCurrentWord+"\")'>"+varInches[i][0]+"</td>";
		else strDivInchesHTML+="<td onclick='cellClicked("+this.intMyId+","+i+",\""+strCurrentWord+"\")'>"+varInches[i][0]+"</td>";
	}
	strDivInchesHTML+="</tr></table>";
	this.divInches.innerHTML=strDivInchesHTML;
};
txtInput.prototype.resetStrTexts=function(){
	this.strTextBefore="";
	this.strTextOnCursor="";
	this.strTextAfter="";
};
txtInput.prototype.replaceText=function(){
	if(null!=this.strReplaceEntry){
		this.strTextOnCursor=this.strReplaceEntry;
	}
};
txtInput.prototype.cancelEntry=function(blnClearEntry){
	if(true==this.blnWordChoiceMode){
		this.clearDivInches();
     		if(true==blnClearEntry)
			this.strTextOnCursor="";
		this.renderTxtInput();
		this.resetStrTexts();
	}
};
txtInput.prototype.artificialBackspacePressed=function(){
     	/*this.cancelEntry(false);*/
	if(true==this.blnWordChoiceMode)
     		this.cancelEntry(true);
	else{
		var intPreviousSelectionStart=this.textArea.selectionStart;
		this.textArea.value=this.textArea.value.substring(0,this.textArea.selectionStart-1)+this.textArea.value.substring(this.textArea.selectionStart);
		this.textArea.focus();
		this.textArea.selectionStart=intPreviousSelectionStart-1;
		this.textArea.selectionEnd=intPreviousSelectionStart-1;
	}
	this.blnWordChoiceMode=false;
};
txtInput.prototype.backspacePressed=function(evtKey){
     	/*this.cancelEntry(false);*/
	if(undefined!=evtKey.preventDefault)
     		this.cancelEntry(true);
	else this.cancelEntry(false);
	this.blnWordChoiceMode=false;
};
txtInput.prototype.escapePressed=function(evtKey){
     	this.cancelEntry(true);
	this.blnWordChoiceMode=false;
};
txtInput.prototype.spacePressed=function(evtKey){
	if(false==this.chkInches.checked)return;
	if(false==this.blnWordChoiceMode)return;
	this.replaceText();
	var newSelection=this.strTextBefore.length+this.strTextOnCursor.length;
	if(undefined!=evtKey.preventDefault)
		evtKey.preventDefault();
	this.renderTxtInput();
	this.blnWordChoiceMode=false;
	this.resetStrTexts();
	this.clearDivInches();
	this.textArea.selectionStart=newSelection;
	this.textArea.selectionEnd=newSelection;
};
txtInput.prototype.enterPressed=function(){
	this.blnWordChoiceMode=false;
	this.clearDivInches();
};
txtInput.prototype.renderTxtInput=function(){
	this.textArea.value=this.strTextBefore+this.strTextOnCursor+this.strTextAfter;
};
txtInput.prototype.computeStrTextBeforeAfter=function(blnArtificial){
	var cursorPos=this.textArea.selectionStart;
	if(false==blnArtificial){
		this.strTextBefore=this.textArea.value.substring(0,cursorPos);
		this.strTextAfter=this.textArea.value.substring(cursorPos,this.textArea.value.length);
	}else{
		this.strTextBefore=this.textArea.value.substring(0,cursorPos-1);
		this.strTextAfter=this.textArea.value.substring(cursorPos,this.textArea.value.length);
	}
	this.strTextOnCursor="";
};
txtInput.prototype.txtInputKeypressed=function(evtKey){
	if(" "==evtKey.key){
		this.spacePressed(evtKey);
		return;
	}
	if("Enter"==evtKey.key){
		this.enterPressed();
		return;
	}
	var intCharCode=evtKey.key.charCodeAt(0);
	if(10==intCharCode||13==intCharCode)return;
	if(1==evtKey.key.length){
		if(true==this.chkInches.checked){
			if(false==this.blnWordChoiceMode){
				if(undefined!=evtKey.preventDefault)
					this.computeStrTextBeforeAfter(false); 
				else this.computeStrTextBeforeAfter(true); 
			};
			this.blnWordChoiceMode=true;
			if(undefined!=evtKey.preventDefault)
				evtKey.preventDefault();
			this.strTextOnCursor+=evtKey.key;
			this.renderDivInches(this.strTextOnCursor);
			this.renderTxtInput();
		}

	}
};
txtInput.prototype.arrowUpPressed=function(evtKey){
	if(null==this.intReplaceEntrySubindex)return;
	if(true==this.blnWordChoiceMode)if(undefined!=evtKey.preventDefault)evtKey.preventDefault();
	if(true==this.blnWordChoiceMode){
		this.intReplaceEntrySubindex--;
		this.renderDivInches(this.strTextOnCursor,this.intReplaceEntrySubindex);
		this.renderTxtInput();
	}
};
txtInput.prototype.arrowDownPressed=function(evtKey){
	if(-1==this.intReplaceEntrySubindex)return;
	if(true==this.blnWordChoiceMode)if(undefined!=evtKey.preventDefault)evtKey.preventDefault();
	if(true==this.blnWordChoiceMode){
		this.intReplaceEntrySubindex++;
		this.renderDivInches(this.strTextOnCursor,this.intReplaceEntrySubindex);
		this.renderTxtInput();
	}
};
txtInput.prototype.emptyKeyEvent=function(){
	var evtKey={};
	evtKey.altKey=false;
	evtKey.ctrlKey=false;
	evtKey.shiftKey=false;
	evtKey.key="";
	evtKey.code="";
	return evtKey;
};
txtInput.prototype.txtInputOnInput=function(evtKey){
	var that0,that1;
	if(undefined!=this.super){
		that0=this;
		that1=this.super;
	}else{
		that0=txtInputs[intPreviousTxtInput];
		that1=this;
	}
	if(true==that1.blnOninputDone){
		that1.blnOninputDone=false;
		return;
	}
	var chrValue=that0.value[that0.selectionStart-1];
	if(undefined!=chrValue&&null!=chrValue){
		var newEvent=that1.emptyKeyEvent();
		newEvent.key=chrValue;newEvent.code=chrValue;
		var intCode=chrValue.charCodeAt(0);
		if(intCode>=65&&intCode<=90)newEvent.shiftKey=true;
		if("string"==typeof(chrValue)&&1==chrValue.length){
			that1.txtInputKeyDown(newEvent);
			that1.value="";
		}
	}
};
txtInput.prototype.txtInputKeyDown=function(evtKey){
	if("Unidentified"==evtKey.key)return;
	var that;
	if(undefined!=this.super){
		that=this.super;
		that0=this.super;
		that1=this;
	}
	else{
		 that=this;
		 that1=this;
		 that0=txtInputs[intPreviousTxtInput];
	}

	if(undefined==evtKey.key){
                var whichKeyCode=evtKey.keyCode||evtKey.which;
                if(undefined!=whichKeyCode&&0!=whichKeyCode&&229!=whichKeyCode){ 
			var strKey;
			switch(whichKeyCode){
				case 8:strKey="Backspace";break;
				case 13:strKey="Enter";break;
				case 27:strKey="Escape";break;
				case 37:strKey="ArrowLeft";break;
				case 38:strKey="ArrowUp";break;
				case 39:strKey="ArrowRight";break;
				case 40:strKey="ArrowDown";break;
				default:return;break;
			}
			var newEvent=that0.emptyKeyEvent();
			newEvent.key=strKey;newEvent.code=strKey;
			that0.blnOninputDone=true;
			that0.txtInputKeyDown(newEvent);
			return;
                    }
	}else{
		if(null==varDictionary&&true==that.chkInches.checked){
			alert(strLoadKeyboardDictionaryFirst);
			return;
		}
		if("ArrowLeft"==evtKey.key){
			that.blnWordChoiceMode=false;
			return;
		}
		if("ArrowRight"==evtKey.key){
			that.blnWordChoiceMode=false;
			return;
		}
		if("ArrowUp"==evtKey.key||"-"==evtKey.key){
			that.arrowUpPressed(evtKey);
			return;
		}
		if("ArrowDown"==evtKey.key||"+"==evtKey.key){
			that.arrowDownPressed(evtKey);
			return;
		}
		if("Backspace"==evtKey.key){
			that.blnOninputDone=true;
			that.backspacePressed(evtKey);
			return;
		}
		if("Delete"==evtKey.key){
			that.blnWordChoiceMode=false;
			return;
		}
		if("Escape"==evtKey.key){
			that.escapePressed(evtKey);
			return;
		}
		that.txtInputKeypressed(evtKey);
	}
};
function init(){
	textArea=new txtInput(document.getElementById("txtInput"),document.getElementById("divInches"),document.getElementById("chkInches"));	
	textSymbols=new txtInput(document.getElementById("txtSymbols"),document.getElementById("divInchesSymbols"),document.getElementById("chkInchesSymbols"));	

	document.getElementById("btnArtificialEscape").onclick=btnArtificialEscapeClicked;
	document.getElementById("btnArtificialBackspace").onclick=btnArtificialBackspaceClicked;
	document.getElementById("btnResize1").onclick=btnResize1pressed;
	document.getElementById("btnResize2").onclick=btnResize2pressed;
	document.getElementById("txtSymbols").onchange=txtSymbolsChanged;
	document.getElementById("btnOpenSlownik").onclick=btnOpenSlownikPressed;
	document.getElementById("btnOpenDictionary").onclick=btnOpenDictionaryPressed;
	document.getElementById("btnOpenBothDictionaries").onclick=btnOpenBothDictionaryPressed;
	document.getElementById("btnFindWord").onclick=btnFindWordPressed;
	document.getElementById("btnFindSymbols").onclick=btnFindSymbolsPressed;
	document.getElementById("btnFindSymbols_next").onclick=btnFindSymbolsNextPressed;
	document.getElementById("btnFindPinyin").onclick=btnFindPinyinPressed;
	document.getElementById("btnFindPinyin_next").onclick=btnFindPinyinNextPressed;
	document.getElementById("btnFindMeanings").onclick=btnFindMeaningsPressed;
	document.getElementById("btnFindMeanings_next").onclick=btnFindMeaningsNextPressed;
	document.getElementById("btnUpdate").onclick=btnUpdatePressed;
	document.getElementById("btnDelete").onclick=btnDeletePressed;
	document.getElementById("btnSearchFrom0").onclick=btnSearchFrom0pressed;
	document.getElementById("btnSaveSlownik").onclick=btnSaveSlownikPressed;
	document.getElementById("btnCorrectTones").onclick=btnCorrectTonesPressed;
	document.getElementById("btnAppendToKeyboardDictionary").onclick=btnAppendToKeyboardDictionaryPressed;
	document.getElementById("btnSaveBothDictionaries").onclick=btnSaveBothDictionariesPressed;
	document.getElementById("btnPrintSlownik").onclick=printSlownik;
	document.getElementById("btnPrintKeyboardDictionary").onclick=printKeyboardDictionary;
	openFile(dispFile);
}
txtInput.prototype.chkInchesChanged=function(){
	var that0,that1;
	if(undefined!=this.super){
		that0=this.super;
		that1=this;
	}
	else{
		that0=this;
		that1=this.chkInches;
	}
	if(false==that1.checked)that0.blnWordChoiceMode=false;
	that0.resetStrTexts();
};
window.onload=init;
		</script>
		<body style="background-color:black;color:grey;">
			<div id="divInches"> </div>
			<button id="btnArtificialEscape" style="width:50px;height:50px">Esc</button>
			<textarea id="txtInput"></textarea>
			<button id="btnArtificialBackspace" style="width:50px;height:50px">&#60&#45</button>
			<input type="checkbox" id="chkInches" checked>Inches</input>
			<button id="btnResize1">Textarea size</button>
			
			<p id="demo"></p>
			<button id="btnOpenDictionary">Open keyboard dictionary</button>
			<button id="btnOpenSlownik">Open dictionary</button>
			<button id="btnOpenBothDictionaries">Open both dictionaries</button>
			<div id="divInchesSymbols"> </div>
			<table>
				<tr>
					<td></td><td><button id="btnFindWord">Find word</button>
					<button id="btnFindSymbols">Find first symbol</button>
					<button id="btnFindSymbols_next">Next symbol</button>
					</td>
					<td></td><td><button id="btnFindPinyin">Find first pinyin</button>
					<button id="btnFindPinyin_next">Next pinyin</button>
					</td>
					<td><button id="btnFindMeanings">Find first meaning</button>
						<button id="btnFindMeanings_next">Next meaning</button>
					</td>

				</tr><tr>
					<td>Symbols:</td>
					<td><input type="text" id="txtSymbols"></input></td>
					<td><input type="checkbox" id="chkInchesSymbols">Inches</input> &nbsp;&nbsp;&nbsp; Pinyin:</td>
					<td><input type="text" id="txtPinyin"></input></td>
					<td><button id="btnUpdate">Update</button>
					<button id="btnDelete">Delete</button>
					<button id="btnSearchFrom0">Search from 0</button>
					</td>
				</tr><tr>
					<td>Meanings:</td>
					<td><input type="text" id="txtMeanings0"></input></td>
					<td><input type="text" id="txtMeanings1"></input></td>
					<td><input type="text" id="txtMeanings2"></input></td>
				</tr>
			</table>
			<textarea id="txtSlownik" cols=120 rows=30></textarea>
			<br/>
			<table><tr>
					<td><button id="btnSaveSlownik">Save dictionary from memory</button></td>
					<td><button id="btnCorrectTones">Correct tones from loaded keyboard dictionary</button></td>
					<td><button id="btnAppendToKeyboardDictionary">Append to keyboard dictionary from memory and save</button></td>
					<td><a id="save" download="dictionary.txt" href="data:text/plain,no data to save, press the button first&#10;">Download dictionary.txt</a></td>
					</tr><tr>
					<td><button id="btnPrintSlownik">Print dictionary</button></td>
					<td><button id="btnPrintKeyboardDictionary">Print keyboard dictionary</button>
					<input type="checkbox" id="chkIgnoreUnknownPinyins">Ignore unknown pinyins</input></td>
					<td><button id="btnSaveBothDictionaries">Save both dictionaries from memory</button></td>
					<td><button id="btnResize2">Textarea size</button></td>
				</tr></table>


		</body>
</html>
